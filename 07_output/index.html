<!DOCTYPE html>
<html lang="en">
  <head>
  
    <title>PS70: Intro to Digital Fabrication --- Week 7: Output Devices</title>
  
    <!-- External Stylesheets -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  
    <!-- Internal Stylesheets -->
    <!-- <link href="./style.css" rel="stylesheet"> -->
    <link href="../static/styles.css" rel="stylesheet">
  
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">
    
    <!-- Arduino Code Style -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script> 
  </head>

<body>

  <br>
  <br>

<header id="header">
    <!-- Nav -->
      <nav>
        <ul>
          <li><a href="../index.html">Explorations</a></li>
          <li><a href="../about.html">About</a></li>
        </ul>
      </nav>
</header>


  <div class="aboutme">
    <div class="subhead">
      <div class="blue heavy">Week 7</div> Putting Out: Output Devices
    </div>
    <div class="demi blue bigger">
      Topics Covered:
    </div>
    <ol>
        <li><b class="blue">How To</b>
            <ul>
                <li>Capacitative Sensing</li>
            </ul>   
        </li>
        <li><b class="blue">Explorations</b>
            <ul>
                <li>Make my own Capacitative Sensor: Angle Sensor
                <li>Mic: Audio Sensor
                <li>Future: BPM, RFID</li>
            </ul>        
        </li>
    </ol>
    <hr>
    <div>
      <br>
      <b class="blue">The assignment:</b>
      <ol>
        <li>Use an output device that you haven't used before today.</li>
        <li>Write a microcontroller program that integrates at least one input device and one output device. Avoid the delay() function and use the C++ class structure.</li>
        <li>Use an oscilloscope to discover the time domain at which your output device is operating. Is it on a fixed clock? What's its speed? Share images and describe your findings.</li>
        <li>Prepare CAD files for CNC (next class). Consider either 2D DXF files for routing sheet material (like plywood or OSB), or 3D STL files to mill out a (2.5D) shape. We will also cover molding & casting, so you may want to consider milling a mold.</li>
      </ol>


      <hr>
      <div class="subsubhead">
        1a. Use New Output Devices: LED Strips
      </div>

      <br><b>Code:</b><br>
      <pre><code class="language-arduino">
        #include <Adafruit_NeoPixel.h>

          #define LED_PIN   9   //The pin connected to the NeoPixels.
          #define LED_COUNT 10  //The number of NeoPixels attached.
          #define DELAY_VAL 300
          
          //Declare our NeoPixel strip object:
          //Arg 1: # of pixels; Arg 2: Arduino pin #; Arg 3: pixel type flags, add together as needed
          //   NEO_KHZ800  800 KHz bitstream (most NeoPixel products w/WS2812 LEDs)
          //   NEO_KHZ400  400 KHz (classic 'v1' (not v2) FLORA pixels, WS2811 drivers)
          //   NEO_GRB     Pixels are wired for GRB bitstream (most NeoPixel products)
          //   NEO_RGB     Pixels are wired for RGB bitstream (v1 FLORA pixels, not v2)
          //   NEO_RGBW    Pixels are wired for RGBW bitstream (NeoPixel RGBW products)
          
          Adafruit_NeoPixel strip(LED_COUNT, LED_PIN, NEO_GRB + NEO_KHZ800);
          
          void setup() {
            // put your setup code here, to run once:
            strip.begin();
            strip.show(); //Initialize all pixels to off.
            strip.setBrightness(20);
          }
          
          void loop() {
            // put your main code here, to run repeatedly:
            strip.fill(strip.Color(255,0,255,50));
            strip.show();
            delay(100);
          
          for(int i=0; i < LED_COUNT; i++) {
              strip.setPixelColor(i, 0, min(20*i, 255),0);
              strip.show();
              delay(DELAY_VAL);
              strip.setPixelColor(i, min(20*i, 255),0,0);
              strip.show();
              delay(DELAY_VAL);
            }
          }
      </code></pre>

      <pre><code class="language-arduino">
        #include <Adafruit_NeoPixel.h>

          #define LED_PIN   9   //The pin connected to the NeoPixels.
          #define LED_COUNT 10  //The number of NeoPixels attached.
          #define DELAY_VAL 300
          
          //Declare our NeoPixel strip object:
          //Arg 1: # of pixels; Arg 2: Arduino pin #; Arg 3: pixel type flags, add together as needed
          
          Adafruit_NeoPixel strip(LED_COUNT, LED_PIN, NEO_GRB + NEO_KHZ800);
          
          void setup() {
            strip.begin();
            strip.show(); //Initialize all pixels to off.
            strip.setBrightness(12);
          }
          
          void loop() {
            strip.clear();
            for(int i=0; i < LED_COUNT; i++) {
                strip.setPixelColor(i, min(50+10*i,255),min(255-20*i,255),min(20+15*i,255));
                strip.show();
                delay(DELAY_VAL);
            }
          }
      </code></pre>

      <video width="80%" controls>
        <source src="./vid_mic.MOV" type="video/mp4">
      Your browser does not support the video tag.
      </video>

      <pre><code class="language-arduino"> 
        #include <Adafruit_NeoPixel.h>

          #define LED_PIN   9   //The pin connected to the NeoPixels.
          #define LED_COUNT 10  //The number of NeoPixels attached.
          #define DELAY_VAL 300
          
          //Declare our NeoPixel strip object:
          //Arg 1: # of pixels; Arg 2: Arduino pin #; Arg 3: pixel type flags, add together as needed
          
          Adafruit_NeoPixel strip(LED_COUNT, LED_PIN, NEO_GRB + NEO_KHZ800);
          
          void setup() {
            strip.begin();
            strip.show(); //Initialize all pixels to off.
            strip.setBrightness(12);
          }
          
          void loop() {
            for(int i=0; i < LED_COUNT; i++) {
              strip.rainbow(65535-(i*6553),1,255,255,true); //Replace the first value with i*6553 to get the spectrum moving down the strip rather than up the strip.
              strip.show();
              delay(100);
            }
          }
      </code></pre>

      <video width="80%" controls>
        <source src="./vid_mic.MOV" type="video/mp4">
      Your browser does not support the video tag.
      </video>


      <!-- <div class="subsubhead">
        1b. Use New Output Devices: Piezo Buzzers
      </div> -->

      <div class="subsubhead">
        2. Write a Microcontroller Program with an Input AND Output: 
      </div>
      The following code uses the MEMS Mic to take audio as an input, and uses a relay and pump to make the flow of water the output.

      <br><br>
      When any reasonably loud noise is being made, the current will flow! And at an ambient room-level of noise, the current will not flow.
      <br><br>

      <pre><code class="prettyprint lang-arduino pre-scrollable prettyprinted">
        /*********
  Rui Santos
  Complete project details at https://RandomNerdTutorials.com/esp32-relay-module-ac-web-server/
  
  The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.
*********/
const int relay = 40;

const int sampleWindow = 50; // Sample window width in mS (50 mS = 20Hz)
 unsigned int sample;

 void setup() 
 {
    Serial.begin(9600);
    pinMode(relay, OUTPUT); //set relay pin as an OUTPUT
 }


 void loop() 
 {
    unsigned long startMillis= millis();  // Start of sample window
    unsigned int peakToPeak = 0;   // peak-to-peak level

    unsigned int signalMax = 0;
    unsigned int signalMin = 1024;

    // collect data for 50 mS
    while (millis() - startMillis < sampleWindow)
    {
       sample = analogRead(0);   //reading DC pin from pin A0
       if (sample < 1024)  // toss out spurious readings
       {
          if (sample > signalMax)
          {
             signalMax = sample;  // save just the max levels
          }
          else if (sample < signalMin)
          {
             signalMin = sample;  // save just the min levels
          }
       }
    }
    peakToPeak = signalMax - signalMin;  // max - min = peak-peak amplitude

    Serial.println(peakToPeak);
    
    //If there's some noise, let the current flow.
    if (peakToPeak > 20) {
      digitalWrite(relay, LOW);
      Serial.println("Current Flowing");
      delay(5000); 
    }
    //If there's no loud noises, don't let the current flow.
    else {
      digitalWrite(relay, HIGH);
      Serial.println("Current not Flowing");
      delay(1000);
    }
 }
      </code></pre>
      <li><a download href="./input_output/input_output.ino"> Download my Arduino Code </a><br></li>
      <br><br>



      <!-- <div class="subsubhead">
        3. Use Oscilloscope
      </div>

      <div class="subsubhead">
        4. Prepare CAD Files for CNC
      </div>
      
      See <a href="../08_CNC_mold/index.html">Week 8</a>! -->
 
    </div>
  

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>

</html>